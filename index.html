
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Lausanne Iconographie LTM</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">






    <style id="compiled-css" type="text/css">
        html, body {margin:0;padding:0;height:100%;}

        #map{
            width:100%;
            height:99%
        }

        .popup {
            text-align:center;
        }
        .popup .slideshow .image        { display:none; }
        .popup .slideshow .image.active { display:block; }
        .popup .slideshow img {
            width:100%;
        }
        .popup .slideshow .caption {
            background:#eee;
            padding:10px;
        }
        .popup .cycle {
            padding:10px 0 20px;
        }
        .popup .cycle a.prev { float:left; }
        .popup .cycle a.next { float:right; }
        /* EOS */


    </style>

    <script id="insert"></script>


</head>
<body>
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search@2.3.7/dist/leaflet-search.src.css" />

    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
            integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
            crossorigin=""></script>
    <script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
    <link rel="stylesheet" href="dist/MarkerCluster.css" />
    <link rel="stylesheet" href="dist/MarkerCluster.Default.css" />
    <script src="dist/leaflet.markercluster-src.js"></script>
    <script src="data.js"></script>

</head>
<body>
<div id="map"></div>
</body>
</html>

<script type="text/javascript">//<![CDATA[




var map = L.map('map').setView([46.522935, 6.6322734], 13);

L.tileLayer( 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    subdomains: ['a','b','c']
}).addTo( map );

var markers = L.markerClusterGroup();

var sitis =  L.geoJson(geoJson, {
        // pointToLayer: function (feature, latlng) {
        //     feature.properties.myKey = feature.properties.Title + ', ' + feature.properties.Head
        //     return L.circleMarker(latlng, geojsonMarkerOptions);
        // },
        onEachFeature: onEachFeature
    }
)

//L.tileLayer( 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="openstreetmap.org/copyright">OpenStreetMap</a>', subdomains: ['a','b','c'] }).addTo( map )

function onEachFeature(feature, layer) {
// does this feature have a property named popupContent?
    if (feature.properties && feature.properties.Title) {
        var marker = L.marker(new L.LatLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]), { title: feature.properties.Title });

        var images = feature.properties.images
        var slideshowContent = '';

        for(var i = 0; i < images.length; i++) {
            var img = images[i];
            if (img[1] == "None"){
                slideshowContent += '<div class="image' + (i === 0 ? ' active' : '') + '">' +
                    '<img src="' + img[0] + '" />' +
                    '</div>';
            } else{
                slideshowContent += '<div class="image' + (i === 0 ? ' active' : '') + '">' +
                    '<img src="' + img[0] + '" />' +
                    '<div class="caption">' + img[1] + '</div>' +
                    '</div>';
            }

        }

        if (images.length > 1) {
            var popupContent =  '<div id="' + feature.properties.Title + '" class="popup">' +
                "<h1><font color='red'>"+feature.properties.Title+"</font></h1>"+
                // <h2>Address: " +feature.properties.Head+
                // "</h2><p>"+feature.properties.Description+"</p><p> Website:"
                // +feature.properties.URL+

                '<div class="slideshow">' +
                slideshowContent +
                '</div>' +
                '<div class="cycle">' +
                '<a href="#" class="prev">&laquo; Previous</a>' +
                '<a href="#" class="next">Next &raquo;</a>' +
                '</div>'
            '</div>';
        } else {
            var popupContent =  '<div id="' + feature.properties.Title + '" class="popup">' +
                "<h1><font color='red'>"+feature.properties.Title+"</font></h1>"+
                // <h2>Address: " +feature.properties.Head+
                // "</h2><p>"+feature.properties.Description+"</p><p> Website:"
                // +feature.properties.URL+

                '<div class="slideshow">' +
                slideshowContent +

                '</div>';
        }


        // layer.bindPopup(popupContent);
        // marker.bindPopup(popupContent).on('click', clickZoom).on('click', clickZoom);
        marker.bindPopup(popupContent, {
            maxWidth: window.innerWidth/1.5,
            maxHeight: window.innerHeight/1.5
        });
        markers.addLayer(marker);
        function clickZoom(e) {
            map.setView(e.target.getLatLng());
        }

    }
};
map.addLayer(markers);
map.on('popupopen', function(e) {
    var px = map.project(e.target._popup._latlng); // find the pixel location on the map where the popup anchor is
    px.y -= e.target._popup._container.clientHeight/2; // find the height of the popup container, divide by 2, subtract from the Y axis of marker location
    map.panTo(map.unproject(px),{animate: true}); // pan to new center
});


$('#map').on('click', '.popup .cycle a', function() {
    var $slideshow = $('.slideshow'),
        $newSlide;

    if ($(this).hasClass('prev')) {
        $newSlide = $slideshow.find('.active').prev();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').last();
        }
    } else {
        $newSlide = $slideshow.find('.active').next();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').first();
        }
    }

    $slideshow.find('.active').removeClass('active').hide();
    $newSlide.addClass('active').show();
    return false;
});

// L.control.search({
//     layer: L.layerGroup ([sitis]),
//     initial: false,
//     propertyName: 'myKey', // Specify which property is searched into.
//     zoom: 14,
//     placeholder: "Search order",
//     position: 'topleft'
// })
//     .addTo(map);



//]]></script>

<script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
        window.parent.parent.postMessage(["resultsFrame", {
            height: document.body.getBoundingClientRect().height,
            slug: "rv28aznx"
        }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
</script>


</body>
</html>
